import{_ as Y,c as d,a as e,b as c,w as p,v as L,d as D,F as g,f as x,t as i,n as K,l as y,m as f,o as Q,p as W,A as G,q as u}from"./main-B_gwUFM9.js";const H={name:"LedgerTable",setup(){const E=new G,o=y([]),k=y(!0),s=y(null),_=y(1),w=y(50),t=y("timestamp"),v=y("desc"),n=y({search:"",orderId:"",jobId:"",actionType:"",commodityType:"",fromDate:"",toDate:""}),T=[{key:"entry_id",label:"Entry ID"},{key:"order_id",label:"Order ID (Raw)"},{key:"business_order_id",label:"Order ID (Resolved)"},{key:"job_id",label:"Job ID (Raw)"},{key:"business_job_id",label:"Job ID (Resolved)"},{key:"commodity_type",label:"Commodity"},{key:"action_type",label:"Action"},{key:"quantity",label:"Quantity"},{key:"timestamp",label:"Timestamp"},{key:"site_id",label:"Site ID"},{key:"metadata",label:"Metadata"}],A=f(()=>{const r=[...new Set(o.value.map(a=>a.business_order_id).filter(Boolean))],l=[...new Set(o.value.map(a=>a.order_id).filter(Boolean))];return[...r,...l].sort()}),j=f(()=>{const r=[...new Set(o.value.map(a=>a.business_job_id).filter(Boolean))],l=[...new Set(o.value.map(a=>a.job_id).filter(Boolean))];return[...r,...l].sort()}),O=f(()=>[...new Set(o.value.map(l=>l.action_type))].sort()),P=f(()=>[...new Set(o.value.map(l=>l.commodity_type))].sort()),C=f(()=>{let r=[...o.value];if(n.value.search){const l=n.value.search.toLowerCase();r=r.filter(a=>a.entry_id.toLowerCase().includes(l)||a.business_order_id&&a.business_order_id.toLowerCase().includes(l)||a.order_id&&String(a.order_id).toLowerCase().includes(l)||a.business_job_id&&a.business_job_id.toLowerCase().includes(l)||a.job_id&&String(a.job_id).toLowerCase().includes(l)||a.commodity_type.toLowerCase().includes(l)||a.action_type.toLowerCase().includes(l)||a.site_id&&a.site_id.toLowerCase().includes(l))}return n.value.orderId&&(r=r.filter(l=>l.business_order_id===n.value.orderId||l.order_id===n.value.orderId)),n.value.jobId&&(r=r.filter(l=>l.business_job_id===n.value.jobId||l.job_id===n.value.jobId)),n.value.actionType&&(r=r.filter(l=>l.action_type===n.value.actionType)),n.value.commodityType&&(r=r.filter(l=>l.commodity_type===n.value.commodityType)),n.value.fromDate&&(r=r.filter(l=>l.timestamp>=n.value.fromDate)),n.value.toDate&&(r=r.filter(l=>l.timestamp<=n.value.toDate+"T23:59:59")),r.sort((l,a)=>{let b=l[t.value],m=a[t.value];return b==null&&(b=""),m==null&&(m=""),b=String(b),m=String(m),v.value==="asc"?b.localeCompare(m):m.localeCompare(b)}),r}),R=f(()=>Math.ceil(C.value.length/w.value)),V=f(()=>{const r=(_.value-1)*w.value,l=r+w.value;return C.value.slice(r,l)}),N=async()=>{try{k.value=!0,s.value=null;const r=await E.getAllLedgerEntriesWithBusinessKeys();o.value=r}catch(r){console.error("Error loading ledger entries:",r),s.value="Failed to load ledger entries"}finally{k.value=!1}},F=r=>{t.value===r?v.value=v.value==="asc"?"desc":"asc":(t.value=r,v.value="asc")},B=()=>{n.value={search:"",orderId:"",jobId:"",actionType:"",commodityType:"",fromDate:"",toDate:""},_.value=1},U=r=>({CREATE_ORDER:"bg-green-100 text-green-800",ALLOCATED_TO_JOB:"bg-blue-100 text-blue-800",RECORD_DELIVERY:"bg-purple-100 text-purple-800",RECONCILE_DELIVERY:"bg-yellow-100 text-yellow-800",LOSS_ADJUSTMENT:"bg-red-100 text-red-800"})[r]||"bg-gray-100 text-gray-800",q=r=>r==null?"N/A":new Intl.NumberFormat().format(r),M=r=>r?new Date(r).toLocaleString():"N/A",J=()=>{const r=T.map(S=>S.label).join(","),l=C.value.map(S=>T.map(z=>{const h=S[z.key];return typeof h=="string"&&(h.includes(",")||h.includes('"'))?`"${h.replace(/"/g,'""')}"`:h||""}).join(",")),a=[r,...l].join(`
`),b=new Blob([a],{type:"text/csv"}),m=window.URL.createObjectURL(b),I=document.createElement("a");I.href=m,I.download=`ledger-entries-${new Date().toISOString().split("T")[0]}.csv`,I.click(),window.URL.revokeObjectURL(m)};return Q(n,()=>{_.value=1},{deep:!0}),W(()=>{N()}),{allEntries:o,loading:k,error:s,filters:n,columns:T,uniqueOrderIds:A,uniqueJobIds:j,uniqueActionTypes:O,uniqueCommodityTypes:P,filteredEntries:C,paginatedEntries:V,currentPage:_,pageSize:w,totalPages:R,sortColumn:t,sortDirection:v,sortBy:F,clearFilters:B,getActionTypeClass:U,formatNumber:q,formatDate:M,exportToCSV:J}}},X={class:"ledger-table"},Z={class:"mb-6"},$={class:"bg-white p-4 rounded-lg shadow-sm border mb-4"},ee={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},te=["value"],oe=["value"],se=["value"],re={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4"},le=["value"],ae={class:"mt-4"},ie={key:0,class:"flex justify-center items-center h-64"},ne={class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"},de={class:"bg-white rounded-lg shadow-sm border overflow-hidden"},ue={class:"px-4 py-3 border-b border-gray-200"},ce={class:"flex justify-between items-center"},me={class:"text-lg font-medium text-gray-900"},be={class:"overflow-x-auto"},ge={class:"min-w-full divide-y divide-gray-200"},ye={class:"bg-gray-50"},pe=["onClick"],fe={class:"flex items-center space-x-1"},ve={key:0,class:"text-blue-600"},xe={class:"bg-white divide-y divide-gray-200"},_e={class:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900"},we={class:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ke={class:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},De={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Te={class:"px-6 py-4 whitespace-nowrap"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ee={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ae={key:0,class:"px-4 py-3 border-t border-gray-200"},je={class:"flex items-center justify-between"},Oe={class:"text-sm text-gray-700"},Pe={class:"flex space-x-2"},Re=["disabled"],Ve={class:"px-3 py-1 text-sm text-gray-700"},Ne=["disabled"];function Fe(E,o,k,s,_,w){return u(),d("div",X,[e("div",Z,[o[22]||(o[22]=e("h1",{class:"text-2xl font-bold text-gray-900 mb-4"},"Ledger Visualization",-1)),c(" Filters "),e("div",$,[e("div",ee,[c(" Search "),e("div",null,[o[11]||(o[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Search",-1)),p(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>s.filters.search=t),type:"text",placeholder:"Search entries...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[L,s.filters.search]])]),c(" Order ID Filter "),e("div",null,[o[13]||(o[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Order ID",-1)),p(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>s.filters.orderId=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[o[12]||(o[12]=e("option",{value:""},"All Orders",-1)),(u(!0),d(g,null,x(s.uniqueOrderIds,t=>(u(),d("option",{key:t,value:t},i(t),9,te))),128))],512),[[D,s.filters.orderId]])]),c(" Job ID Filter "),e("div",null,[o[15]||(o[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Job ID",-1)),p(e("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>s.filters.jobId=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[o[14]||(o[14]=e("option",{value:""},"All Jobs",-1)),(u(!0),d(g,null,x(s.uniqueJobIds,t=>(u(),d("option",{key:t,value:t},i(t),9,oe))),128))],512),[[D,s.filters.jobId]])]),c(" Action Type Filter "),e("div",null,[o[17]||(o[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Action Type",-1)),p(e("select",{"onUpdate:modelValue":o[3]||(o[3]=t=>s.filters.actionType=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[o[16]||(o[16]=e("option",{value:""},"All Actions",-1)),(u(!0),d(g,null,x(s.uniqueActionTypes,t=>(u(),d("option",{key:t,value:t},i(t),9,se))),128))],512),[[D,s.filters.actionType]])])]),c(" Additional Filters Row "),e("div",re,[c(" Commodity Type Filter "),e("div",null,[o[19]||(o[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Commodity Type",-1)),p(e("select",{"onUpdate:modelValue":o[4]||(o[4]=t=>s.filters.commodityType=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[o[18]||(o[18]=e("option",{value:""},"All Commodities",-1)),(u(!0),d(g,null,x(s.uniqueCommodityTypes,t=>(u(),d("option",{key:t,value:t},i(t),9,le))),128))],512),[[D,s.filters.commodityType]])]),c(" Date Range "),e("div",null,[o[20]||(o[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"From Date",-1)),p(e("input",{"onUpdate:modelValue":o[5]||(o[5]=t=>s.filters.fromDate=t),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[L,s.filters.fromDate]])]),e("div",null,[o[21]||(o[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"To Date",-1)),p(e("input",{"onUpdate:modelValue":o[6]||(o[6]=t=>s.filters.toDate=t),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[L,s.filters.toDate]])])]),c(" Clear Filters Button "),e("div",ae,[e("button",{onClick:o[7]||(o[7]=(...t)=>s.clearFilters&&s.clearFilters(...t)),class:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Clear Filters ")])])]),c(" Loading State "),s.loading?(u(),d("div",ie,o[23]||(o[23]=[e("div",{class:"text-gray-600"},"Loading ledger entries...",-1)]))):s.error?(u(),d(g,{key:1},[c(" Error State "),e("div",ne,i(s.error),1)],2112)):(u(),d(g,{key:2},[c(" Table "),e("div",de,[e("div",ue,[e("div",ce,[e("h2",me," Ledger Entries ("+i(s.filteredEntries.length)+" of "+i(s.allEntries.length)+") ",1),e("button",{onClick:o[8]||(o[8]=(...t)=>s.exportToCSV&&s.exportToCSV(...t)),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"}," Export CSV ")])]),e("div",be,[e("table",ge,[e("thead",ye,[e("tr",null,[(u(!0),d(g,null,x(s.columns,t=>(u(),d("th",{key:t.key,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:v=>s.sortBy(t.key)},[e("div",fe,[e("span",null,i(t.label),1),s.sortColumn===t.key?(u(),d("span",ve,i(s.sortDirection==="asc"?"↑":"↓"),1)):c("v-if",!0)])],8,pe))),128))])]),e("tbody",xe,[(u(!0),d(g,null,x(s.paginatedEntries,t=>(u(),d("tr",{key:t.entry_id,class:"hover:bg-gray-50"},[e("td",_e,i(t.entry_id),1),e("td",we,i(t.order_id||"N/A"),1),e("td",he,i(t.business_order_id||"N/A"),1),e("td",ke,i(t.job_id||"N/A"),1),e("td",Ce,i(t.business_job_id||"N/A"),1),e("td",De,i(t.commodity_type),1),e("td",Te,[e("span",{class:K([s.getActionTypeClass(t.action_type),"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},i(t.action_type),3)]),e("td",Ie,i(s.formatNumber(t.quantity)),1),e("td",Se,i(s.formatDate(t.timestamp)),1),e("td",Le,i(t.site_id||"N/A"),1),e("td",Ee,i(t.metadata?JSON.stringify(t.metadata):"N/A"),1)]))),128))])])]),c(" Pagination "),s.totalPages>1?(u(),d("div",Ae,[e("div",je,[e("div",Oe," Showing "+i((s.currentPage-1)*s.pageSize+1)+" to "+i(Math.min(s.currentPage*s.pageSize,s.filteredEntries.length))+" of "+i(s.filteredEntries.length)+" entries ",1),e("div",Pe,[e("button",{onClick:o[9]||(o[9]=t=>s.currentPage=Math.max(1,s.currentPage-1)),disabled:s.currentPage===1,class:"px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"}," Previous ",8,Re),e("span",Ve," Page "+i(s.currentPage)+" of "+i(s.totalPages),1),e("button",{onClick:o[10]||(o[10]=t=>s.currentPage=Math.min(s.totalPages,s.currentPage+1)),disabled:s.currentPage===s.totalPages,class:"px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"}," Next ",8,Ne)])])])):c("v-if",!0)])],2112))])}const Ue=Y(H,[["render",Fe],["__scopeId","data-v-d0a2d022"],["__file","/app/src/js/components/LedgerTable.vue"]]);export{Ue as default};
