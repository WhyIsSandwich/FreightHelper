import{_ as $,l as M,m as E,o as Q,c as m,a as o,b as p,w as B,v as U,n as I,F as q,f as j,t as O,q as l,r as z,D as te,s as K,h as G,g as oe,d as se,i as re,u as ie,x as ne,p as ae}from"./main-B_gwUFM9.js";import{C as F}from"./commodityService-_7iYQTpz.js";import{L as le,C as de}from"./CommodityFlowSummaryModal-BowMhHdn.js";const me={name:"SearchableSelect",props:{modelValue:{type:String,default:""},options:{type:Array,default:()=>[]},groupedOptions:{type:Array,default:null},placeholder:{type:String,default:"Search..."}},emits:["update:modelValue"],setup(f,{emit:t}){const C=M(null),e=M(!1),x=M(""),b=M(-1),i=E(()=>{if(f.groupedOptions)return[];if(!x.value)return f.options.slice(0,50);const y=x.value.toLowerCase();return f.options.filter(g=>g.label.toLowerCase().includes(y)||g.value.toLowerCase().includes(y)).slice(0,50)}),r=E(()=>{if(!f.groupedOptions)return[];if(!x.value)return f.groupedOptions.slice(0,10);const y=x.value.toLowerCase();return f.groupedOptions.map(g=>({...g,options:g.options.filter(s=>s.label.toLowerCase().includes(y)||s.value.toLowerCase().includes(y))})).filter(g=>g.options.length>0).slice(0,10)}),k=E(()=>{if(f.groupedOptions){const y=f.groupedOptions.flatMap(g=>g.options);return f.modelValue&&!y.some(g=>g.value===f.modelValue)}return f.modelValue&&!f.options.some(y=>y.value===f.modelValue)}),a=(y,g)=>{let s=0;for(let n=0;n<y;n++)s+=r.value[n].options.length;return s+g},L=()=>f.groupedOptions?r.value.reduce((y,g)=>y+g.options.length,0):i.value.length,S=y=>{t("update:modelValue",y.value),x.value=y.label,e.value=!1,b.value=-1},A=()=>{setTimeout(()=>{e.value=!1,b.value=-1},150)},P=y=>{if(!e.value){e.value=!0;return}switch(y.key){case"ArrowDown":y.preventDefault();const g=L();b.value=Math.min(b.value+1,g-1);break;case"ArrowUp":y.preventDefault(),b.value=Math.max(b.value-1,-1);break;case"Enter":if(y.preventDefault(),b.value>=0)if(f.groupedOptions){let s=0;for(const n of r.value)for(const v of n.options){if(s===b.value){S(v);return}s++}}else i.value[b.value]&&S(i.value[b.value]);break;case"Escape":e.value=!1,b.value=-1;break}};return Q(()=>f.modelValue,y=>{if(y){let g=null;if(f.groupedOptions){for(const s of f.groupedOptions)if(g=s.options.find(n=>n.value===y),g)break}else g=f.options.find(s=>s.value===y);g&&(x.value=g.label)}else x.value=""},{immediate:!0}),Q(x,()=>{b.value=-1}),{inputRef:C,isOpen:e,searchTerm:x,highlightedIndex:b,filteredOptions:i,filteredGroups:r,hasError:k,getGlobalIndex:a,selectOption:S,handleBlur:A,handleKeydown:P}}},ue={class:"relative"},ce={class:"relative"},ye=["placeholder"],ge={class:"absolute inset-y-0 right-0 flex items-center pr-2"},pe={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto"},fe={class:"px-3 py-2 bg-gray-50 text-xs font-medium text-gray-600 uppercase tracking-wider"},ve=["onMousedown"],be=["onMousedown"],xe={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg"};function he(f,t,C,e,x,b){return l(),m("div",ue,[o("div",ce,[B(o("input",{ref:"inputRef","onUpdate:modelValue":t[0]||(t[0]=i=>e.searchTerm=i),onFocus:t[1]||(t[1]=i=>e.isOpen=!0),onClick:t[2]||(t[2]=i=>e.isOpen=!0),onBlur:t[3]||(t[3]=(...i)=>e.handleBlur&&e.handleBlur(...i)),onKeydown:t[4]||(t[4]=(...i)=>e.handleKeydown&&e.handleKeydown(...i)),type:"text",placeholder:C.placeholder,class:I(["w-full px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":e.hasError}])},null,42,ye),[[U,e.searchTerm]]),o("div",ge,[(l(),m("svg",{class:I(["w-4 h-4 text-gray-400",{"rotate-180":e.isOpen}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[5]||(t[5]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),p(" Dropdown "),e.isOpen&&(e.filteredOptions.length>0||e.filteredGroups.length>0)?(l(),m("div",pe,[p(" Grouped options "),C.groupedOptions&&e.filteredGroups.length>0?(l(!0),m(q,{key:0},j(e.filteredGroups,(i,r)=>(l(),m("div",{key:i.name,class:"border-b border-gray-100 last:border-b-0"},[o("div",fe,O(i.name),1),(l(!0),m(q,null,j(i.options,(k,a)=>(l(),m("div",{key:k.value,onMousedown:L=>e.selectOption(k),class:I(["px-6 py-2 cursor-pointer hover:bg-gray-100 text-sm",{"bg-blue-100":e.getGlobalIndex(r,a)===e.highlightedIndex}])},O(k.label),43,ve))),128))]))),128)):(l(),m(q,{key:1},[p(" Regular options "),(l(!0),m(q,null,j(e.filteredOptions,(i,r)=>(l(),m("div",{key:i.value,onMousedown:k=>e.selectOption(i),class:I(["px-3 py-2 cursor-pointer hover:bg-gray-100",{"bg-blue-100":r===e.highlightedIndex}])},O(i.label),43,be))),128))],64))])):p("v-if",!0),p(" No results "),e.isOpen&&e.filteredOptions.length===0&&e.searchTerm?(l(),m("div",xe,t[6]||(t[6]=[o("div",{class:"px-3 py-2 text-gray-500 text-sm"},"No commodities found",-1)]))):p("v-if",!0)])}const W=$(me,[["render",he],["__scopeId","data-v-a2458dac"],["__file","/app/src/js/components/SearchableSelect.vue"]]),Ce={name:"CommodityParserModal",components:{SearchableSelect:W},props:{isOpen:{type:Boolean,default:!1}},emits:["close","commodities-assigned"],setup(f,{emit:t}){const C=M(""),e=M([]),x=F.getCommodityNames(),b=x.map(s=>({value:s,label:s})),i=E(()=>{const s={};return F.getAllCommodities().forEach(v=>{const h=v.category||"Other";s[h]||(s[h]=[]),s[h].push({value:v.name,label:v.name})}),Object.keys(s).map(v=>({name:v,options:s[v].sort((h,u)=>h.label.localeCompare(u.label))})).sort((v,h)=>v.name.localeCompare(h.name))}),r=E(()=>e.value.filter(s=>s.status==="valid").length),k=E(()=>e.value.filter(s=>s.status==="invalid").length),a=()=>{if(!C.value.trim()){e.value=[];return}const s=C.value.split(`
`).filter(v=>v.trim()),n=[];for(const v of s){const h=v.trim();if(e.value.some(d=>d.originalText===h))continue;const u=L(h);n.push({originalText:h,status:u&&!u.error?"valid":"invalid",commodity_type:(u==null?void 0:u.commodity_type)||"",quantity:(u==null?void 0:u.quantity)||0,error:(u==null?void 0:u.error)||null})}e.value.push(...n)},L=s=>{s=s.replace(/^[-•*]\s*/,"").replace(/\s*$/,"");const n=[{regex:/^(.+?)[:\-]\s*(\d+(?:,\d{3})*(?:\.\d+)?)$/,type:"colon_dash",description:"Commodity: Quantity or Commodity - Quantity"},{regex:/^(.+?),\s*(\d+(?:,\d{3})*(?:\.\d+)?)$/,type:"comma",description:"Commodity, Quantity"},{regex:/^(\d+(?:,\d{3})*(?:\.\d+)?)\s*x?\s*(.+)$/,type:"quantity_first",description:"Quantity Commodity or Quantity x Commodity"},{regex:/^(.+?)\s+(\d+(?:,\d{3})*(?:\.\d+)?)$/,type:"commodity_first",description:"Commodity Quantity"}];for(const v of n){const h=s.match(v.regex);if(h){let u,d;if(v.type==="colon_dash"||v.type==="comma")u=h[1].trim(),d=parseFloat(h[2].replace(/,/g,""));else if(v.type==="quantity_first")d=parseFloat(h[1].replace(/,/g,"")),u=h[2].trim();else if(v.type==="commodity_first"){const D=h[1].trim(),R=h[2].trim();/^\d+(?:,\d{3})*(?:\.\d+)?$/.test(D)?(d=parseFloat(D.replace(/,/g,"")),u=R):(u=D,d=parseFloat(R.replace(/,/g,"")))}if(console.log(`Pattern "${v.description}" matched: "${s}"`),console.log(`Parsed: "${u}" -> quantity: ${d}`),/^\d+(?:,\d{3})*(?:\.\d+)?$/.test(u)){console.log(`Rejecting: "${u}" is a pure number, not a commodity type`);continue}const T=S(u);if(console.log(`Normalized: "${u}" -> "${T}"`),T&&d>0&&!isNaN(d))return{commodity_type:T,quantity:d};if(console.log(`Validation failed: normalizedType="${T}", quantity=${d}`),T){if(d<=0||isNaN(d))return{error:`Invalid quantity: ${d}`}}else return{error:`Commodity "${u}" not found in database`}}}return console.log(`No pattern matched for: "${s}"`),{error:"Could not parse format"}},S=s=>{if(!s)return console.log("Normalizing: null/empty type"),null;const n=s.trim();if(console.log(`Normalizing: "${n}"`),/^\d+(?:,\d{3})*(?:\.\d+)?$/.test(n))return console.log(`Rejecting pure number: "${n}"`),null;if(n.length<2)return console.log(`Rejecting too short: "${n}"`),null;const v=F.getCommodity(n);if(v)return console.log(`Exact match found: "${v.name}"`),v.name;const h=x.find(d=>d.toLowerCase()===n.toLowerCase());if(h)return console.log(`Case-insensitive exact match found: "${h}"`),h;const u=F.searchCommodities(n);if(console.log(`Search results for "${n}":`,u.map(d=>d.name)),u.length>0){const d=u[0];if(d.name.toLowerCase()===n.toLowerCase())return console.log(`Very close match found: "${d.name}"`),d.name;const T=n.toLowerCase(),D=d.name.toLowerCase();if(T.includes(D)||D.includes(T))return console.log(`Containment match found: "${d.name}"`),d.name;if(n.length>=4){const R=Math.min(n.length,d.name.length)/Math.max(n.length,d.name.length);if(console.log(`Similarity check: ${R} (threshold: 0.7)`),R>=.7)return console.log(`Similarity match found: "${d.name}"`),d.name}}return console.log(`No match found for: "${n}"`),null},A=s=>{e.value.splice(s,1)},P=()=>{e.value=[],C.value=""},y=()=>{const s=e.value.filter(n=>n.status==="valid"&&n.commodity_type&&n.quantity>0).map(n=>({commodity_type:n.commodity_type,quantity:n.quantity}));s.length>0&&(t("commodities-assigned",{direct:s}),g())},g=()=>{t("close")};return Q(()=>f.isOpen,s=>{s&&(C.value="",e.value=[])}),{rawCommodityText:C,parsedRows:e,commodityNames:x,commodityOptions:b,commodityGroupedOptions:i,validRowsCount:r,invalidRowsCount:k,parseCommodities:a,removeRow:A,clearAll:P,applyValidCommodities:y,closeModal:g}}},we={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},_e={class:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden"},ke={class:"flex items-center justify-between p-6 border-b border-gray-200"},Se={class:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]"},Oe={class:"mb-6"},Me={key:0,class:"mb-6"},Ve={class:"overflow-x-auto"},Le={class:"min-w-full bg-white border border-gray-200 rounded-lg"},Ee={class:"divide-y divide-gray-200"},Te={class:"px-4 py-2 text-sm text-gray-900"},Ae={class:"px-4 py-2"},De={class:"px-4 py-2"},Pe={key:1,class:"text-sm text-red-600"},Re={class:"px-4 py-2"},Ne=["onUpdate:modelValue"],Ie={key:1,class:"text-sm text-red-600"},qe={class:"px-4 py-2"},Fe=["onClick"],Be={key:1,class:"mb-6 p-4 bg-gray-50 rounded-lg"},je={class:"flex items-center justify-between"},Ue={class:"text-sm text-gray-600"},ze={class:"text-green-600 font-medium"},Ge={class:"text-red-600 font-medium"},Qe={class:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50"},Ke={class:"text-sm text-gray-500"},$e={class:"flex gap-3"},He=["disabled"];function We(f,t,C,e,x,b){const i=z("SearchableSelect");return C.isOpen?(l(),m("div",we,[o("div",_e,[p(" Modal Header "),o("div",ke,[t[7]||(t[7]=o("h3",{class:"text-lg font-semibold text-gray-900"},"Parse Commodity List",-1)),o("button",{onClick:t[0]||(t[0]=(...r)=>e.closeModal&&e.closeModal(...r)),class:"text-gray-400 hover:text-gray-600 transition-colors"},t[6]||(t[6]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),p(" Modal Body "),o("div",Se,[p(" Input Area "),o("div",Oe,[t[8]||(t[8]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Paste your commodity list below ",-1)),B(o("textarea",{"onUpdate:modelValue":t[1]||(t[1]=r=>e.rawCommodityText=r),onInput:t[2]||(t[2]=(...r)=>e.parseCommodities&&e.parseCommodities(...r)),rows:"6",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Paste your commodity list here...

Examples:
- Steel: 1000
- Water: 500
- 2000 Steel
- Steel 1000
- Gold, 500
- Silver: 200, Platinum: 100`},null,544),[[U,e.rawCommodityText]])]),p(" Parsing Results Grid "),e.parsedRows.length>0?(l(),m("div",Me,[t[10]||(t[10]=o("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Parsing Results",-1)),o("div",Ve,[o("table",Le,[t[9]||(t[9]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Original Text "),o("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),o("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Commodity Type "),o("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Quantity "),o("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),o("tbody",Ee,[(l(!0),m(q,null,j(e.parsedRows,(r,k)=>(l(),m("tr",{key:k,class:I(["hover:bg-gray-50",r.status==="valid"?"bg-green-50":"bg-red-50"])},[o("td",Te,O(r.originalText),1),o("td",Ae,[o("span",{class:I(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r.status==="valid"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},O(r.status==="valid"?"Valid":"Invalid"),3)]),o("td",De,[r.status==="valid"?(l(),te(i,{key:0,modelValue:r.commodity_type,"onUpdate:modelValue":a=>r.commodity_type=a,"grouped-options":e.commodityGroupedOptions,placeholder:"Select commodity"},null,8,["modelValue","onUpdate:modelValue","grouped-options"])):(l(),m("span",Pe,O(r.error||"Could not parse"),1))]),o("td",Re,[r.status==="valid"?B((l(),m("input",{key:0,"onUpdate:modelValue":a=>r.quantity=a,type:"number",min:"1",class:"w-full px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,Ne)),[[U,r.quantity,void 0,{number:!0}]]):(l(),m("span",Ie,"-"))]),o("td",qe,[o("button",{onClick:a=>e.removeRow(k),class:"text-red-600 hover:text-red-800 font-medium"}," Remove ",8,Fe)])],2))),128))])])])])):p("v-if",!0),p(" Summary "),e.parsedRows.length>0?(l(),m("div",Be,[o("div",je,[o("div",Ue,[o("span",ze,O(e.validRowsCount),1),t[11]||(t[11]=K(" valid, ")),o("span",Ge,O(e.invalidRowsCount),1),t[12]||(t[12]=K(" invalid "))]),o("button",{onClick:t[3]||(t[3]=(...r)=>e.clearAll&&e.clearAll(...r)),class:"text-sm text-gray-500 hover:text-gray-700"}," Clear All ")])])):p("v-if",!0)]),p(" Modal Footer "),o("div",Qe,[o("div",Ke,O(e.validRowsCount)+" commodities ready to add ",1),o("div",$e,[o("button",{onClick:t[4]||(t[4]=(...r)=>e.closeModal&&e.closeModal(...r)),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors"}," Cancel "),o("button",{onClick:t[5]||(t[5]=(...r)=>e.applyValidCommodities&&e.applyValidCommodities(...r)),disabled:e.validRowsCount===0,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"}," Add "+O(e.validRowsCount)+" Commodities ",9,He)])])])])):p("v-if",!0)}const Je=$(Ce,[["render",We],["__scopeId","data-v-eb3a1f77"],["__file","/app/src/js/components/CommodityParserModal.vue"]]),Xe={name:"SiteManagement",components:{CommodityParserModal:Je,CommodityFlowSummaryModal:de,SearchableSelect:W,LedgerTableReusable:le},setup(){const f=re(),t=ie(),C=ne(),e=E(()=>f.params.orderId),x=E(()=>f.params.siteId),b=E(()=>!!x.value),i=M({site_name:"",type:"",orderCommodities:[]}),r=M(null),k=M([]),a=M(!1),L=M(!1),S=M(null),A=M(!1),P=M(!1),y=E(()=>i.value.site_name&&i.value.type),g=async()=>{if(b.value)try{L.value=!0,S.value=null;const c=await C.getOrder(e.value);if(!c){S.value="Order not found";return}const V=c.sites.find(w=>w.site_id===x.value);if(!V){S.value="Site not found";return}r.value=V,i.value={site_name:V.site_name,type:V.type,orderCommodities:[...V.orderCommodities]};const _=await C.getLedgerEntriesForOrder(e.value);k.value=_.filter(w=>w.site_id===x.value)}catch(c){console.error("Error loading site data:",c),S.value="Failed to load site data"}finally{L.value=!1}},s=async()=>{try{A.value=!0;const c=await C.getOrder(e.value);if(!c)throw new Error("Order not found");const V={site_id:b.value?x.value:`SITE-${Date.now()}-${Math.random().toString(36).substring(2,8).toUpperCase()}`,site_name:i.value.site_name,type:i.value.type,orderCommodities:i.value.orderCommodities};let _;b.value?_=c.sites.map(N=>N.site_id===x.value?V:N):_=[...c.sites,V];const w={...c,sites:_};await C.updateOrder(e.value,w),t.push(`/order/${e.value}`)}catch(c){console.error(`Error ${b.value?"updating":"creating"} site:`,c),alert(`Failed to ${b.value?"update":"create"} site. Please try again.`)}finally{A.value=!1}},n=()=>{t.push(`/order/${e.value}`)},v=c=>{switch(c){case"planet":return"bg-green-100 text-green-800";case"orbital":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},h=c=>{if(c.direct)i.value.orderCommodities.push(...c.direct);else{const V=c.current_site||[];i.value.orderCommodities.push(...V)}},u=c=>{i.value.orderCommodities.splice(c,1)},d=()=>{i.value.orderCommodities.push({commodity_type:"",quantity:1})},T=()=>{P.value=!0},D=()=>{P.value=!1},R=async()=>{var _;if(!b.value||!x.value)return;const c=((_=r.value)==null?void 0:_.site_name)||"this site";if(confirm(`Are you sure you want to delete "${c}"?

This will permanently remove the site and all its commodities from the order. This action cannot be undone.`))try{A.value=!0;const w=await C.getOrder(e.value);if(!w)throw new Error("Order not found");const N=w.sites.filter(ee=>ee.site_id!==x.value),Z={...w,sites:N};await C.updateOrder(e.value,Z),t.push(`/order/${e.value}`)}catch(w){console.error("Error deleting site:",w),alert("Failed to delete site. Please try again.")}finally{A.value=!1}},J=()=>{confirm("Are you sure you want to clear all commodities?")&&(i.value.orderCommodities=[])},H=F.getCommodityNames(),X=H.map(c=>({value:c,label:c})),Y=E(()=>{const c={};return F.getAllCommodities().forEach(_=>{const w=_.category||"Other";c[w]||(c[w]=[]),c[w].push({value:_.name,label:_.name})}),Object.keys(c).map(_=>({name:_,options:c[_].sort((w,N)=>w.label.localeCompare(N.label))})).sort((_,w)=>_.name.localeCompare(w.name))});return ae(()=>{g()}),{orderId:e,siteId:x,isEditing:b,formData:i,siteData:r,siteLedgerEntries:k,showSiteLedgerModal:a,loading:L,error:S,submitting:A,isFormValid:y,loadSiteData:g,handleSubmit:s,goBack:n,confirmDeleteSite:R,getSiteTypeClass:v,handleCommoditiesAssigned:h,removeCommodity:u,addCommodity:d,openCommodityParser:T,closeCommodityParser:D,isCommodityParserOpen:P,clearAllCommodities:J,commodityNames:H,commodityOptions:X,commodityGroupedOptions:Y}}},Ye={class:"site-management"},Ze={class:"bg-white rounded-lg p-8 shadow-md"},et={class:"mb-6"},tt={class:"flex items-center justify-between mb-2"},ot={class:"flex gap-3"},st=["disabled"],rt=["disabled"],it={class:"text-3xl font-bold text-gray-900"},nt={class:"text-gray-600 mt-1"},at={key:0,class:"flex justify-center items-center h-64"},lt={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6"},dt={class:"form-section"},mt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ut={class:"form-group"},ct={class:"form-group"},yt={class:"form-section"},gt={class:"mb-6"},pt={class:"overflow-x-auto"},ft={class:"min-w-full bg-white border border-gray-200 rounded-lg"},vt={class:"divide-y divide-gray-200"},bt={class:"px-4 py-2"},xt={class:"px-4 py-2"},ht=["onUpdate:modelValue"],Ct={class:"px-4 py-2"},wt=["onClick"],_t={key:0},kt={class:"mt-3 flex gap-2"},St={key:3,class:"ledger-section mt-8"},Ot={class:"section-header"},Mt={class:"flex items-center justify-between"},Vt={class:"text-sm text-gray-600"},Lt={key:0,class:"text-center py-8 text-gray-500"};function Et(f,t,C,e,x,b){const i=z("SearchableSelect"),r=z("CommodityParserModal"),k=z("CommodityFlowSummaryModal");return l(),m("div",Ye,[o("div",Ze,[o("div",et,[o("div",tt,[o("button",{onClick:t[0]||(t[0]=(...a)=>e.goBack&&e.goBack(...a)),class:"text-gray-600 hover:text-gray-800 transition-colors"}," ← Back to Order "),o("div",ot,[o("button",{type:"button",onClick:t[1]||(t[1]=(...a)=>e.goBack&&e.goBack(...a)),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors font-medium"}," Cancel "),e.isEditing?(l(),m("button",{key:0,type:"button",onClick:t[2]||(t[2]=(...a)=>e.confirmDeleteSite&&e.confirmDeleteSite(...a)),disabled:e.submitting,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors font-medium disabled:bg-gray-400 disabled:cursor-not-allowed"}," Delete Site ",8,st)):p("v-if",!0),o("button",{type:"submit",form:"siteForm",disabled:!e.isFormValid||e.submitting,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors font-medium disabled:bg-gray-400 disabled:cursor-not-allowed"},O(e.submitting?"Saving...":e.isEditing?"Update Site":"Add Site"),9,rt)])]),o("h1",it,O(e.isEditing?"Edit Site":"Add New Site"),1),o("p",nt,O(e.isEditing&&e.siteData?`Edit site ${e.siteData.site_name}`:"Add a new site to this order."),1)]),e.loading?(l(),m("div",at,t[11]||(t[11]=[o("div",{class:"text-gray-600"},"Loading site data...",-1)]))):e.error?(l(),m("div",lt,O(e.error),1)):(l(),m("form",{key:2,id:"siteForm",onSubmit:t[8]||(t[8]=oe((...a)=>e.handleSubmit&&e.handleSubmit(...a),["prevent"])),class:"space-y-8"},[p(" Site Information "),o("div",dt,[t[15]||(t[15]=o("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Site Information",-1)),o("div",mt,[o("div",ut,[t[12]||(t[12]=o("label",{for:"siteName",class:"block text-sm font-medium text-gray-700 mb-1"}," Site Name * ",-1)),B(o("input",{id:"siteName","onUpdate:modelValue":t[3]||(t[3]=a=>e.formData.site_name=a),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter site name"},null,512),[[U,e.formData.site_name]])]),o("div",ct,[t[14]||(t[14]=o("label",{for:"siteType",class:"block text-sm font-medium text-gray-700 mb-1"}," Site Type * ",-1)),B(o("select",{id:"siteType","onUpdate:modelValue":t[4]||(t[4]=a=>e.formData.type=a),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},t[13]||(t[13]=[o("option",{value:""},"Select type",-1),o("option",{value:"planet"},"Planet",-1),o("option",{value:"orbital"},"Orbital",-1)]),512),[[se,e.formData.type]])])])]),p(" Commodities Management "),o("div",yt,[t[20]||(t[20]=o("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Commodities",-1)),p(" Commodity Parser "),o("div",gt,[o("button",{type:"button",onClick:t[5]||(t[5]=(...a)=>e.openCommodityParser&&e.openCommodityParser(...a)),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"}," Parse Commodity List "),t[16]||(t[16]=o("p",{class:"text-xs text-gray-500 mt-1"}," Click to open a parser for pasting commodity lists in any format. ",-1))]),p(" Current Site Commodities "),o("div",null,[t[19]||(t[19]=o("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Current Commodities:",-1)),o("div",pt,[o("table",ft,[t[18]||(t[18]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Commodity Type "),o("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Quantity "),o("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),o("tbody",vt,[(l(!0),m(q,null,j(e.formData.orderCommodities,(a,L)=>(l(),m("tr",{key:L,class:"hover:bg-gray-50"},[o("td",bt,[G(i,{modelValue:a.commodity_type,"onUpdate:modelValue":S=>a.commodity_type=S,"grouped-options":e.commodityGroupedOptions,placeholder:"Select commodity"},null,8,["modelValue","onUpdate:modelValue","grouped-options"])]),o("td",xt,[B(o("input",{"onUpdate:modelValue":S=>a.quantity=S,type:"number",min:"1",class:"w-full px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,ht),[[U,a.quantity,void 0,{number:!0}]])]),o("td",Ct,[o("button",{type:"button",onClick:S=>e.removeCommodity(L),class:"text-red-600 hover:text-red-800 font-medium"}," Remove ",8,wt)])]))),128)),e.formData.orderCommodities.length===0?(l(),m("tr",_t,t[17]||(t[17]=[o("td",{colspan:"3",class:"px-4 py-8 text-center text-gray-500"},' No commodities added yet. Use the parser above or click "Add Commodity" below. ',-1)]))):p("v-if",!0)])])]),o("div",kt,[o("button",{type:"button",onClick:t[6]||(t[6]=(...a)=>e.addCommodity&&e.addCommodity(...a)),class:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors"}," Add Commodity "),e.formData.orderCommodities.length>0?(l(),m("button",{key:0,type:"button",onClick:t[7]||(t[7]=(...a)=>e.clearAllCommodities&&e.clearAllCommodities(...a)),class:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors"}," Clear All ")):p("v-if",!0)])])])],32)),p(" Ledger Table Section (only show when editing) "),e.isEditing?(l(),m("div",St,[o("div",Ot,[t[22]||(t[22]=o("h3",{class:"text-lg font-semibold text-gray-900"},"Commodity Flow Summary",-1)),o("div",Mt,[o("p",Vt," View detailed flow data for "+O(e.siteLedgerEntries.length)+" entries ",1),e.siteLedgerEntries.length>0?(l(),m("button",{key:0,onClick:t[9]||(t[9]=a=>e.showSiteLedgerModal=!0),class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},t[21]||(t[21]=[o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),K(" View Summary ")]))):p("v-if",!0)])]),e.siteLedgerEntries.length===0?(l(),m("div",Lt," No ledger entries found for this site ")):p("v-if",!0)])):p("v-if",!0)]),p(" Commodity Parser Modal "),G(r,{"is-open":e.isCommodityParserOpen,onClose:e.closeCommodityParser,onCommoditiesAssigned:e.handleCommoditiesAssigned},null,8,["is-open","onClose","onCommoditiesAssigned"]),p(" Site Ledger Modal "),G(k,{"is-open":e.showSiteLedgerModal,"flow-summary":[],"ledger-entries":e.siteLedgerEntries,onClose:t[10]||(t[10]=a=>e.showSiteLedgerModal=!1)},null,8,["is-open","ledger-entries"])])}const Pt=$(Xe,[["render",Et],["__scopeId","data-v-9e01a239"],["__file","/app/src/js/components/SiteManagement.vue"]]);export{Pt as default};
