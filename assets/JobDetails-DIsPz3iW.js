import{_ as he,r as Ce,c as m,a as t,b as h,h as we,t as c,n as je,g as xe,w as S,v as I,d as L,e as Ee,s as R,B as Q,F as D,f as B,i as Ae,u as Se,l as x,m as J,p as ke,o as De,A as Je,C as Be,q as y}from"./main-B_gwUFM9.js";import{C as Te,L as qe}from"./CommodityFlowSummaryModal-BowMhHdn.js";import{C as Ie}from"./commodityService-_7iYQTpz.js";function Fe(i,e=null,u=[],o=null){if(!i)return"No job data available";const s=[],C=Me(i.job_type);s.push(`CONTRACT: ${C}`),s.push("--------------------------------------------------"),e!=null&&e.system_name&&s.push(`System: ${e.system_name}`),e!=null&&e.client_name&&i.job_type!=="fac"&&s.push(`Client: ${e.client_name}`),i.external_job_id&&s.push(`Order: ${i.external_job_id}`),s.push(`Job Type: ${C}`);const v=z(i.commodities,u);if(v.length===1&&s.push(`Jobsite: ${v[0]}`),i.due_date){const d=Re(i.due_date);s.push(`Deadline: ${d}`)}s.push(""),i.job_cost&&s.push(`CONTRACT PRICE: ${q(i.job_cost)} cr`);const _=Le(i.commodities);_>0&&s.push(`Total Tonnage: ${q(_)} tons`),o!=null&&o.summary&&(o.summary.hasDistanceBonus&&s.push(`Distance Bonus: ${q(o.summary.distanceBonus)} cr`),o.summary.hasPlanetaryBonus&&s.push(`Planetary Bonus: ${q(o.summary.planetaryBonus)} cr`)),s.push("");const n=i.status||"Pending";s.push(`Status: ${n}`),s.push("Note: Quantities shown are for single contract (1x)"),s.push(""),s.push("ITEMS:");const f=z(i.commodities,u);if(f.length>1){s.push(""),s.push("LOAD INTO FC:"),s.push("```");const d=N(i.commodities,u);Object.entries(d).forEach(([w,g])=>{s.push(`=== ${w} ===`),g.forEach(E=>{const T=E.commodity_type.padEnd(32),A=q(E.quantity).padStart(8);s.push(`${T} | ${A}`)})}),s.push("```"),s.push(""),s.push("UNLOAD AT SITES:"),f.forEach(w=>{s.push(""),s.push(`${w}`),s.push("```");const g=Oe(i.commodities,u,w),E=N(g,u);Object.entries(E).forEach(([T,A])=>{s.push(`=== ${T} ===`),A.forEach(k=>{const b=k.commodity_type.padEnd(32),U=q(k.quantity).padStart(8);s.push(`${b} | ${U}`)})}),s.push("```")})}else{s.push("```");const d=N(i.commodities,u);Object.entries(d).forEach(([w,g])=>{s.push(""),s.push(`=== ${w} ===`),g.forEach(E=>{const T=E.commodity_type.padEnd(32),A=q(E.quantity).padStart(8);s.push(`${T} | ${A}`)})}),s.push("```")}return s.join(`
`)}function N(i,e=[]){if(!i||!Array.isArray(i))return{};const u={},o={},s={};i.forEach(v=>{const _=v.commodity_type;o[_]||(o[_]=0,s[_]=new Set),o[_]+=v.quantity||0;const n=e.find(f=>f.site_id===v.site_id);n&&n.site_name&&s[_].add(n.site_name)}),Object.keys(o).forEach(v=>{const _=Ue(v);u[_]||(u[_]=[]),u[_].push({commodity_type:v,quantity:o[v],sites:Array.from(s[v])})}),Object.keys(u).forEach(v=>{u[v].sort((_,n)=>_.commodity_type.localeCompare(n.commodity_type))});const C={};return Object.keys(u).sort().forEach(v=>{C[v]=u[v]}),C}function z(i,e=[]){if(!i||!Array.isArray(i))return[];const u=new Set;i.forEach(s=>{s.site_id&&u.add(s.site_id)});const o=[];return u.forEach(s=>{const C=e.find(v=>v.site_id===s);C&&C.site_name&&o.push(K(C))}),o.sort()}function K(i){if(!i||!i.site_name)return"Unknown Site";let e=i.site_name;return i.type==="orbital"?e+=" (Orbital)":i.type==="planet"&&(e+=" (Planetary",i.planet_name&&(e+=` - ${i.planet_name}`),i.planet_index&&(e+=` ${i.planet_index}`),e+=")"),e}function Oe(i,e,u){if(!i||!Array.isArray(i))return[];const o=e.find(s=>K(s)===u);return o?i.filter(s=>s.site_id===o.site_id):[]}function Ue(i){try{const u=Ie.getCommodity(i);if(u&&u.category)return u.category}catch{}return{"Computer Components":"Technology","Food Cartridges":"Foods","Fruit And Vegetables":"Foods","Ceramic Composites":"Industrial Materials","CMM Composite":"Industrial Materials","Cmm Composite":"Industrial Materials","Insulating Membrane":"Industrial Materials",Polymers:"Industrial Materials","Nonlethal Weapons":"Weapons","Power Generators":"Machinery","Water Purifiers":"Machinery",Water:"Chemicals",Copper:"Metals",Semiconductors:"Technology",Superconductors:"Technology"}[i]||"Other"}function Me(i){return{contractor:"CONTRACTOR",subcontractor:"SUBCONTRACTOR",orbital:"ORBITAL",ground:"GROUND",fac:"FAC",gaia:"GAIA","small batch":"SMALL BATCH",other:"OTHER"}[i]||i.toUpperCase()}function Le(i){return!i||!Array.isArray(i)?0:i.reduce((e,u)=>e+(u.quantity||0),0)}function q(i){return typeof i!="number"||isNaN(i)?"0":i.toLocaleString()}function Re(i){if(!i)return"Not set";try{const e=new Date(i);return`<t:${Math.floor(e.getTime()/1e3)}:R>`}catch{return i}}async function Ne(i){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(i),!0;{const e=document.createElement("textarea");e.value=i,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const u=document.execCommand("copy");return document.body.removeChild(e),u}}catch{return!1}}const Ve={name:"JobDetails",components:{LedgerTableReusable:qe,CommodityFlowSummaryModal:Te},props:{debug:{type:Boolean,default:!1}},setup(i){const e=Ae(),u=Se(),o=new Je,s=x(null),C=x(null),v=x([]),_=x([]),n=x(!1),f=x(!1),d=x(!1),w=x([]),g=x([]),E=x(!1),T=x("commodity"),A=x(null),k=e.params.orderId,b=e.params.jobId;i.debug&&(console.log("ðŸ” [DEBUG] JobDetails route params:",e.params),console.log("ðŸ” [DEBUG] JobDetails orderId:",k,"type:",typeof k),console.log("ðŸ” [DEBUG] JobDetails jobId:",b,"type:",typeof b));const U=J(()=>{var l;if(!((l=s.value)!=null&&l.commodities))return null;const a={};return s.value.commodities.forEach(r=>{a[r.commodity_type]||(a[r.commodity_type]=[]),a[r.commodity_type].push(r)}),a}),Y=J(()=>{const a={};return g.value.forEach(l=>{a[l.commodity_type]||(a[l.commodity_type]=[]),a[l.commodity_type].push(l)}),a}),X=J(()=>{const a={};return g.value.forEach(l=>{a[l.site_name]||(a[l.site_name]=[]),a[l.site_name].push(l)}),a}),Z=J(()=>{var r;const a=new Set;g.value.forEach(p=>{a.add(p.commodity_type)}),(r=s.value)!=null&&r.commodities&&s.value.commodities.forEach(p=>{a.add(p.commodity_type)});const l=Array.from(a).sort();return console.log("Available commodity types:",l),l}),V=(a,l=null)=>v.value.filter(r=>{var p;return l?r.commodity_type===a&&((p=r.metadata)==null?void 0:p.site_id)===l:r.commodity_type===a}).reduce((r,p)=>r+p.quantity,0),O=(a,l=null)=>{var p;const r=(p=s.value)==null?void 0:p.commodities.find(j=>j.commodity_type===a&&(l?j.site_id===l:!0));return r?r.quantity-V(a,l):0},$=a=>{var l;return(l=s.value)!=null&&l.commodities?s.value.commodities.filter(r=>r.commodity_type===a).reduce((r,p)=>r+p.quantity,0):0},G=J(()=>v.value.reduce((a,l)=>a+l.quantity,0)),ee=J(()=>{var a;return(a=s.value)!=null&&a.commodities?s.value.commodities.reduce((l,r)=>l+O(r.commodity_type,r.site_id),0):0}),te=J(()=>{var l;if(!((l=s.value)!=null&&l.commodities))return 0;const a=s.value.commodities.reduce((r,p)=>r+p.quantity,0);return a?Math.round(G.value/a*100):0}),P=J(()=>s.value?Fe(s.value,C.value,w.value,A.value):"No job data available"),F=async()=>{try{const a=await o.db.jobs.where("job_id").equals(b).first();if(a){a.job_name||(a.job_name=""),s.value=a;const l=await o.db.orders.where("order_id").equals(k).first();l&&(C.value=l);const r=a.id,p=await o.db.ledger.where(["job_id","action_type"]).equals([r,"ALLOCATED_TO_JOB"]).toArray();s.value.commodities=p.map(M=>({commodity_type:M.commodity_type,quantity:M.quantity,site_id:M.site_id}));const j=await o.db.ledger.where(["job_id","action_type"]).equals([r,"RECORD_DELIVERY"]).toArray();v.value=j;const Bo=await o.db.ledger.where("job_id").equals(r).toArray();_.value=await o.getLedgerEntriesForJobWithBusinessKeys(b)}else console.error("Job not found:",b);await ne(),await re(),await W()}catch(a){console.error("Error loading job data:",a)}},oe=async()=>{try{d.value=!0;const a={job_name:s.value.job_name,job_type:s.value.job_type,external_job_id:s.value.external_job_id,contractor_fleet_carrier:s.value.contractor_fleet_carrier,job_cost:s.value.job_cost,due_date:s.value.due_date,updated_at:new Date().toISOString()},l=Be(a);if(await o.db.jobs.update(s.value.id,l),s.value.commodities&&s.value.commodities.length>0){await o.db.ledger.where("job_id").equals(s.value.id).delete();const r=await o.db.orders.where("order_id").equals(s.value.order_id).first();if(!r)throw new Error(`Order not found: ${s.value.order_id}`);for(const p of s.value.commodities){const j={order_id:r.order_id,job_id:s.value.job_id,commodity_type:p.commodity_type,action_type:"ALLOCATED_TO_JOB",quantity:p.quantity,timestamp:new Date().toISOString(),site_id:p.site_id};await o.createLedgerEntryShim(j,{operation:"edit_job",job_type:s.value.job_type})}}await F(),f.value=!1,alert("Job updated successfully!")}catch(a){console.error("Error updating job:",a),alert("Failed to update job. Please try again.")}finally{d.value=!1}},se=async()=>{if(confirm("Are you sure you want to delete this job? This action cannot be undone."))try{await o.deleteJob(b),await u.push(`/order/${k}`)}catch(a){console.error("Error deleting job:",a),alert("Failed to delete job. Please try again.")}},ae=a=>new Date(a).toLocaleDateString(),ie=a=>{if(!a)return"Unknown Site";const l=w.value.find(r=>r.site_id===a);return l?l.site_name:"Unknown Site"},ne=async()=>{try{const a=await o.db.sites.where("order_id").equals(k).toArray();w.value=a}catch(a){console.error("Error loading available sites:",a)}},re=async()=>{try{g.value=await o.getAvailableCommodities(k)}catch(a){console.error("Error loading available commodities:",a)}},le=a=>{s.value.commodities.push({commodity_type:a.commodity_type,quantity:a.available_quantity,site_id:a.site_id})},de=a=>{s.value.commodities.splice(a,1)},ce=()=>{s.value.commodities.push({commodity_type:"",quantity:1,site_id:""})},ue=()=>{E.value=!E.value},me=a=>g.value.filter(l=>l.commodity_type===a).length,ye=a=>g.value.filter(l=>l.site_name===a).length,be=a=>{g.value.filter(r=>r.commodity_type===a).forEach(r=>{s.value.commodities.findIndex(j=>j.commodity_type===r.commodity_type&&j.site_id===r.site_id)===-1&&s.value.commodities.push({commodity_type:r.commodity_type,quantity:r.available_quantity,site_id:r.site_id})})},pe=a=>{g.value.filter(r=>r.site_name===a).forEach(r=>{s.value.commodities.findIndex(j=>j.commodity_type===r.commodity_type&&j.site_id===r.site_id)===-1&&s.value.commodities.push({commodity_type:r.commodity_type,quantity:r.available_quantity,site_id:r.site_id})})},W=async()=>{try{if(i.debug&&(console.log("ðŸ” [DEBUG] loadCostBreakdown called with jobId:",b),console.log("ðŸ” [DEBUG] jobId type:",typeof b,"value:",b)),b&&b!=="undefined"){i.debug&&console.log("ðŸ” [DEBUG] Calling getJobCostBreakdown with jobId:",b);const a=await o.getJobCostBreakdown(b);A.value=a,i.debug&&console.log("ðŸ” [DEBUG] Cost breakdown loaded successfully:",a)}else i.debug&&console.log("ðŸ” [DEBUG] Skipping cost breakdown - jobId is invalid:",b),A.value=null}catch(a){console.error("Error loading cost breakdown:",a),i.debug&&console.error("ðŸ” [DEBUG] Error details - jobId was:",b),A.value=null}},ve=async()=>{try{if(i.debug&&(console.log("ðŸ” [DEBUG] recalculateJobCost called with jobId:",b),console.log("ðŸ” [DEBUG] jobId type:",typeof b,"value:",b)),!b||b==="undefined")throw new Error("Job ID is not available");await o.recalculateJobCost(b),await F(),alert("Job cost recalculated successfully!")}catch(a){console.error("Error recalculating job cost:",a),console.error("ðŸ” [DEBUG] Error details - jobId was:",b),alert("Failed to recalculate job cost. Please try again.")}},H=J(()=>{var a;return!((a=s.value)!=null&&a.commodities)||s.value.commodities.length===0?!1:s.value.commodities.some(l=>O(l.commodity_type,l.site_id)>0)}),fe=a=>{switch(a){case"pending":return"bg-yellow-100 text-yellow-800";case"in-progress":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},_e=async()=>{if(!H.value){alert("No commodities available for delivery");return}if(confirm("Complete this job by recording all remaining deliveries?"))try{const a=`DEL-${Date.now()}-${Math.random().toString(36).substring(2,8).toUpperCase()}`,l=[];for(const r of s.value.commodities){const p=O(r.commodity_type,r.site_id);p>0&&l.push({type:r.commodity_type,quantity:p,metadata:{site_id:r.site_id,notes:"Job completion - automatic delivery recording"}})}await o.recordDelivery(a,b,l),await o.updateJob(b,{status:"completed"}),await F(),alert(`Job completed successfully! All deliveries recorded. Delivery ID: ${a}`)}catch(a){console.error("Error completing job:",a),alert("Failed to complete job. Please try again.")}},ge=async()=>{try{const a=await Ne(P.value);alert(a?"Job formatted and copied to clipboard!":"Failed to copy to clipboard. Please try again.")}catch(a){console.error("Error copying to clipboard:",a),alert("Failed to copy to clipboard. Please try again.")}};return ke(F),De(()=>e.params.jobId,F),{orderId:k,jobId:b,jobData:s,orderData:C,deliveries:v,jobLedgerEntries:_,showJobLedgerModal:n,isEditing:f,submitting:d,availableSites:w,availableCommodities:g,showAvailableCommodities:E,groupBy:T,groupedCommodities:U,groupedByCommodity:Y,groupedBySite:X,availableCommodityTypes:Z,totalDelivered:G,totalRemaining:ee,overallProgress:te,getCommodityDelivered:V,getCommodityRemaining:O,getCommodityTypeTotal:$,canRecordDelivery:H,completeJob:_e,getStatusClass:fe,saveJob:oe,confirmDeleteJob:se,copyFormattedJob:ge,formatDate:ae,getSiteName:ie,addAvailableCommodity:le,removeCommodity:de,addEmptyCommodityRow:ce,toggleAvailableCommodities:ue,getTotalAvailableForType:me,getTotalAvailableForSite:ye,addAllCommoditiesOfType:be,addAllCommoditiesFromSite:pe,costBreakdown:A,loadCostBreakdown:W,recalculateJobCost:ve,formattedJobText:P}}},Ge={class:"job-details"},Pe={class:"job-details-header"},We={class:"header-content"},He={class:"header-actions"},Qe=["disabled"],ze=["disabled"],Ke={class:"job-details-content"},Ye={class:"job-info"},Xe={class:"info-section"},Ze={class:"form-grid"},$e={class:"form-group"},et={class:"form-group"},tt={key:0,class:"form-group"},ot={key:1,class:"form-group"},st={class:"form-group"},at={class:"form-group"},it={class:"commodities-section"},nt={class:"commodities-edit"},rt={class:"commodities-actions"},lt={key:0,class:"available-commodities"},dt={class:"commodity-filters"},ct={key:0,class:"space-y-4"},ut={class:"bg-gray-50 px-4 py-2 border-b flex justify-between items-center"},mt={class:"font-medium text-gray-900"},yt={class:"text-sm text-gray-600"},bt=["onClick","disabled"],pt={class:"divide-y"},vt={class:"flex-1"},ft={class:"font-medium"},_t={class:"text-sm text-gray-600"},gt=["onClick","disabled"],ht={class:"space-y-4"},Ct={class:"bg-gray-50 px-4 py-2 border-b flex justify-between items-center"},wt={class:"font-medium text-gray-900"},jt={class:"text-sm text-gray-600"},xt=["onClick","disabled"],Et={class:"divide-y"},At={class:"flex-1"},St={class:"font-medium"},kt={class:"text-sm text-gray-600"},Dt=["onClick","disabled"],Jt={class:"current-commodities"},Bt={key:0,class:"commodities-table"},Tt={class:"w-full"},qt=["onUpdate:modelValue"],It=["value"],Ft=["onUpdate:modelValue"],Ot=["value"],Ut=["onUpdate:modelValue"],Mt=["onClick"],Lt={key:1,class:"text-gray-500 text-center py-4"},Rt={class:"delivery-summary"},Nt={class:"summary-grid"},Vt={class:"summary-item"},Gt={class:"value"},Pt={class:"summary-item"},Wt={class:"value"},Ht={class:"summary-item"},Qt={class:"value"},zt={key:0,class:"cost-breakdown"},Kt={class:"cost-details"},Yt={class:"cost-item"},Xt={class:"value"},Zt={key:0,class:"cost-item"},$t={class:"value"},eo={key:1,class:"cost-item"},to={class:"value"},oo={class:"cost-item total"},so={class:"value"},ao={class:"cost-item"},io={class:"value"},no={class:"cost-breakdown-details"},ro={class:"cost-breakdown-text"},lo={class:"deliveries-section"},co={class:"deliveries-list"},uo={class:"delivery-header"},mo={class:"delivery-id"},yo={class:"delivery-date"},bo={class:"delivery-details"},po={class:"info-item"},vo={class:"value"},fo={class:"info-item"},_o={class:"value"},go={class:"info-item"},ho={class:"value"},Co={key:0,class:"delivery-notes"},wo={key:1,class:"discord-format-section"},jo={class:"format-actions"},xo={class:"formatted-text-container"},Eo={class:"formatted-text"},Ao={class:"ledger-section"},So={class:"section-header"},ko={class:"flex items-center justify-between"},Do={class:"section-description"};function Jo(i,e,u,o,s,C){var _;const v=Ce("CommodityFlowSummaryModal");return y(),m(D,null,[t("div",Ge,[t("div",Pe,[t("div",We,[t("h1",null,"Job Details - "+c(o.jobId),1),(_=o.jobData)!=null&&_.status?(y(),m("span",{key:0,class:je(["px-3 py-1 text-sm rounded-full font-medium",o.getStatusClass(o.jobData.status)])},c(o.jobData.status),3)):h("v-if",!0)]),t("div",He,[t("button",{class:"btn btn-secondary",onClick:e[0]||(e[0]=n=>i.$router.push(`/order/${o.orderId}`))}," Back to Order "),t("button",{class:"btn btn-success",onClick:e[1]||(e[1]=(...n)=>o.saveJob&&o.saveJob(...n)),disabled:o.submitting},c(o.submitting?"Saving...":"Save Changes"),9,Qe),t("button",{class:"btn btn-success",onClick:e[2]||(e[2]=(...n)=>o.completeJob&&o.completeJob(...n)),disabled:!o.canRecordDelivery}," Complete Job ",8,ze),t("button",{class:"btn btn-secondary",onClick:e[3]||(e[3]=(...n)=>o.recalculateJobCost&&o.recalculateJobCost(...n))}," Recalculate Cost "),t("button",{class:"btn btn-danger",onClick:e[4]||(e[4]=(...n)=>o.confirmDeleteJob&&o.confirmDeleteJob(...n))},"Delete Job")])]),t("div",Ke,[t("div",Ye,[t("div",Xe,[e[26]||(e[26]=t("h3",null,"Job Information",-1)),t("form",{onSubmit:e[11]||(e[11]=xe((...n)=>o.saveJob&&o.saveJob(...n),["prevent"])),class:"edit-form"},[t("div",Ze,[t("div",$e,[e[19]||(e[19]=t("label",{for:"jobName"},"Job Name:",-1)),S(t("input",{type:"text",id:"jobName","onUpdate:modelValue":e[5]||(e[5]=n=>o.jobData.job_name=n),placeholder:"Enter job name"},null,512),[[I,o.jobData.job_name]])]),t("div",et,[e[21]||(e[21]=t("label",{for:"jobType"},"Job Type:",-1)),S(t("select",{id:"jobType","onUpdate:modelValue":e[6]||(e[6]=n=>o.jobData.job_type=n),required:""},e[20]||(e[20]=[Ee('<option value="contractor" data-v-8fc4904c>Contractor (Internal)</option><option value="subcontractor" data-v-8fc4904c>Subcontractor (External)</option><option value="fac" data-v-8fc4904c>FAC</option><option value="gaia" data-v-8fc4904c>Gaia</option><option value="small batch" data-v-8fc4904c>Small Batch</option><option value="other" data-v-8fc4904c>Other</option>',6)]),512),[[L,o.jobData.job_type]])]),o.jobData.job_type==="subcontractor"?(y(),m("div",tt,[e[22]||(e[22]=t("label",{for:"externalJobId"},"External Job ID:",-1)),S(t("input",{type:"text",id:"externalJobId","onUpdate:modelValue":e[7]||(e[7]=n=>o.jobData.external_job_id=n),placeholder:"e.g., CMM-12345, FAC-789"},null,512),[[I,o.jobData.external_job_id]])])):h("v-if",!0),o.jobData.job_type==="contractor"?(y(),m("div",ot,[e[23]||(e[23]=t("label",{for:"contractorFleetCarrier"},"Contractor Fleet/Carrier:",-1)),S(t("input",{type:"text",id:"contractorFleetCarrier","onUpdate:modelValue":e[8]||(e[8]=n=>o.jobData.contractor_fleet_carrier=n),placeholder:"e.g., Fleet Alpha, Carrier Beta"},null,512),[[I,o.jobData.contractor_fleet_carrier]])])):h("v-if",!0),t("div",st,[e[24]||(e[24]=t("label",{for:"jobCost"},"Job Cost:",-1)),S(t("input",{type:"number",id:"jobCost","onUpdate:modelValue":e[9]||(e[9]=n=>o.jobData.job_cost=n),min:"0",step:"0.01"},null,512),[[I,o.jobData.job_cost,void 0,{number:!0}]])]),t("div",at,[e[25]||(e[25]=t("label",{for:"dueDate"},"Due Date:",-1)),S(t("input",{type:"date",id:"dueDate","onUpdate:modelValue":e[10]||(e[10]=n=>o.jobData.due_date=n)},null,512),[[I,o.jobData.due_date]])])])],32)]),t("div",it,[e[34]||(e[34]=t("h3",null,"Commodities",-1)),t("div",nt,[t("div",rt,[t("button",{type:"button",class:"btn btn-primary",onClick:e[12]||(e[12]=(...n)=>o.addEmptyCommodityRow&&o.addEmptyCommodityRow(...n))}," Add Commodity "),t("button",{type:"button",class:"btn btn-secondary",onClick:e[13]||(e[13]=(...n)=>o.toggleAvailableCommodities&&o.toggleAvailableCommodities(...n))},c(o.showAvailableCommodities?"Hide":"Show")+" Available Commodities ",1)]),h(" Available Commodities "),o.showAvailableCommodities?(y(),m("div",lt,[e[29]||(e[29]=t("h4",null,"Available Commodities",-1)),t("div",dt,[t("label",null,[S(t("input",{type:"radio","onUpdate:modelValue":e[14]||(e[14]=n=>o.groupBy=n),value:"commodity"},null,512),[[Q,o.groupBy]]),e[27]||(e[27]=R(" Group by Commodity Type "))]),t("label",null,[S(t("input",{type:"radio","onUpdate:modelValue":e[15]||(e[15]=n=>o.groupBy=n),value:"site"},null,512),[[Q,o.groupBy]]),e[28]||(e[28]=R(" Group by Site "))])]),h(" Commodity Type Grouped View "),o.groupBy==="commodity"?(y(),m("div",ct,[(y(!0),m(D,null,B(o.groupedByCommodity,(n,f)=>(y(),m("div",{key:f,class:"border rounded-lg overflow-hidden"},[t("div",ut,[t("div",null,[t("h4",mt,c(f),1),t("p",yt,c(n.length)+" site"+c(n.length!==1?"s":""),1)]),t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:d=>o.addAllCommoditiesOfType(f),disabled:o.getTotalAvailableForType(f)<=0}," Add All ",8,bt)]),t("div",pt,[(y(!0),m(D,null,B(n,d=>(y(),m("div",{key:`${d.commodity_type}-${d.site_id}`,class:"px-4 py-3 flex justify-between items-center"},[t("div",vt,[t("div",ft,c(d.site_name),1),t("div",_t," Available: "+c(d.available_quantity),1)]),t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:w=>o.addAvailableCommodity(d),disabled:d.available_quantity<=0}," Add ",8,gt)]))),128))])]))),128))])):(y(),m(D,{key:1},[h(" Site Grouped View "),t("div",ht,[(y(!0),m(D,null,B(o.groupedBySite,(n,f)=>(y(),m("div",{key:f,class:"border rounded-lg overflow-hidden"},[t("div",Ct,[t("div",null,[t("h4",wt,c(f),1),t("p",jt,c(n.length)+" commodity type"+c(n.length!==1?"s":""),1)]),t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:d=>o.addAllCommoditiesFromSite(f),disabled:o.getTotalAvailableForSite(f)<=0}," Add All ",8,xt)]),t("div",Et,[(y(!0),m(D,null,B(n,d=>(y(),m("div",{key:`${d.commodity_type}-${d.site_id}`,class:"px-4 py-3 flex justify-between items-center"},[t("div",At,[t("div",St,c(d.commodity_type),1),t("div",kt," Available: "+c(d.available_quantity),1)]),t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:w=>o.addAvailableCommodity(d),disabled:d.available_quantity<=0}," Add ",8,Dt)]))),128))])]))),128))])],2112))])):h("v-if",!0),h(" Current Job Commodities "),t("div",Jt,[e[33]||(e[33]=t("h4",null,"Job Commodities",-1)),o.jobData.commodities&&o.jobData.commodities.length>0?(y(),m("div",Bt,[t("table",Tt,[e[32]||(e[32]=t("thead",null,[t("tr",null,[t("th",null,"Commodity Type"),t("th",null,"Site"),t("th",null,"Quantity"),t("th",null,"Actions")])],-1)),t("tbody",null,[(y(!0),m(D,null,B(o.jobData.commodities,(n,f)=>(y(),m("tr",{key:f},[t("td",null,[S(t("select",{"onUpdate:modelValue":d=>n.commodity_type=d,class:"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[30]||(e[30]=t("option",{value:""},"Select commodity...",-1)),(y(!0),m(D,null,B(o.availableCommodityTypes,d=>(y(),m("option",{key:d,value:d},c(d),9,It))),128))],8,qt),[[L,n.commodity_type]])]),t("td",null,[S(t("select",{"onUpdate:modelValue":d=>n.site_id=d,class:"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[e[31]||(e[31]=t("option",{value:""},"Select site...",-1)),(y(!0),m(D,null,B(o.availableSites,d=>(y(),m("option",{key:d.site_id,value:d.site_id},c(d.site_name),9,Ot))),128))],8,Ft),[[L,n.site_id]])]),t("td",null,[S(t("input",{type:"number","onUpdate:modelValue":d=>n.quantity=d,min:"1",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,8,Ut),[[I,n.quantity,void 0,{number:!0}]])]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-danger",onClick:d=>o.removeCommodity(f)}," Remove ",8,Mt)])]))),128))])])])):(y(),m("div",Lt,' No commodities added yet. Click "Add Commodity" to get started. '))])])]),t("div",Rt,[e[38]||(e[38]=t("h3",null,"Delivery Summary",-1)),t("div",Nt,[t("div",Vt,[e[35]||(e[35]=t("span",{class:"label"},"Overall Progress:",-1)),t("span",Gt,c(o.overallProgress)+"%",1)]),t("div",Pt,[e[36]||(e[36]=t("span",{class:"label"},"Total Remaining:",-1)),t("span",Wt,c(o.totalRemaining),1)]),t("div",Ht,[e[37]||(e[37]=t("span",{class:"label"},"Total Delivered:",-1)),t("span",Qt,c(o.totalDelivered),1)])])]),o.costBreakdown?(y(),m("div",zt,[e[45]||(e[45]=t("h3",null,"Cost Breakdown",-1)),t("div",Kt,[t("div",Yt,[e[39]||(e[39]=t("span",{class:"label"},"Base Cost:",-1)),t("span",Xt,c(o.costBreakdown.summary.baseCost.toLocaleString())+" Cr",1)]),o.costBreakdown.summary.hasPlanetaryBonus?(y(),m("div",Zt,[e[40]||(e[40]=t("span",{class:"label"},"Planetary Bonus (+10%):",-1)),t("span",$t,"+"+c(o.costBreakdown.summary.planetaryBonus.toLocaleString())+" Cr",1)])):h("v-if",!0),o.costBreakdown.summary.hasDistanceBonus?(y(),m("div",eo,[e[41]||(e[41]=t("span",{class:"label"},"Distance Bonus:",-1)),t("span",to,"+"+c(o.costBreakdown.summary.distanceBonus.toLocaleString())+" Cr",1)])):h("v-if",!0),t("div",oo,[e[42]||(e[42]=t("span",{class:"label"},"Total Cost:",-1)),t("span",so,c(o.costBreakdown.summary.totalCost.toLocaleString())+" Cr",1)]),t("div",ao,[e[43]||(e[43]=t("span",{class:"label"},"Cost per Ton:",-1)),t("span",io,c(o.costBreakdown.summary.costPerTon.toLocaleString())+" Cr",1)])]),t("details",no,[e[44]||(e[44]=t("summary",null,"Detailed Breakdown",-1)),t("pre",ro,c(o.costBreakdown.formatted),1)])])):h("v-if",!0),t("div",lo,[e[49]||(e[49]=t("h3",null,"Deliveries",-1)),t("div",co,[(y(!0),m(D,null,B(o.deliveries,n=>{var f,d;return y(),m("div",{key:n.delivery_id,class:"delivery-card"},[t("div",uo,[t("span",mo,c(n.delivery_id),1),t("span",yo,c(o.formatDate(n.timestamp)),1)]),t("div",bo,[t("div",po,[e[46]||(e[46]=t("span",{class:"label"},"Commodity:",-1)),t("span",vo,c(n.commodity_type),1)]),t("div",fo,[e[47]||(e[47]=t("span",{class:"label"},"Quantity:",-1)),t("span",_o,c(n.quantity),1)]),t("div",go,[e[48]||(e[48]=t("span",{class:"label"},"Location:",-1)),t("span",ho,c((f=n.metadata)==null?void 0:f.location),1)])]),(d=n.metadata)!=null&&d.notes?(y(),m("div",Co,c(n.metadata.notes),1)):h("v-if",!0)])}),128))])]),o.isEditing?h("v-if",!0):(y(),m("div",wo,[e[50]||(e[50]=t("h3",null,"Discord Format",-1)),t("div",jo,[t("button",{class:"btn btn-primary",onClick:e[16]||(e[16]=(...n)=>o.copyFormattedJob&&o.copyFormattedJob(...n))}," Copy to Clipboard ")]),t("div",xo,[t("pre",Eo,c(o.formattedJobText),1)])]))]),h(" Ledger Table Section "),t("div",Ao,[t("div",So,[e[52]||(e[52]=t("h3",null,"Commodity Flow Summary",-1)),t("div",ko,[t("p",Do," View detailed flow data for "+c(o.jobLedgerEntries.length)+" entries ",1),t("button",{onClick:e[17]||(e[17]=n=>o.showJobLedgerModal=!0),class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},e[51]||(e[51]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),R(" View Summary ")]))])])])])]),h(" Job Ledger Modal "),we(v,{"is-open":o.showJobLedgerModal,"flow-summary":[],"ledger-entries":o.jobLedgerEntries,onClose:e[18]||(e[18]=n=>o.showJobLedgerModal=!1)},null,8,["is-open","ledger-entries"])],64)}const Fo=he(Ve,[["render",Jo],["__scopeId","data-v-8fc4904c"],["__file","/app/src/js/components/JobDetails.vue"]]);export{Fo as default};
